#!/usr/bin/env python
"""complete task by id/name/class_name"""
# -*- coding: utf-8 -*-
import click
import datetime
import sys
import task.setup
from task.models import Task

MODULE_NAME = "task.complete"
PROG_NAME = 'python -m %s' % MODULE_NAME
USAGE = 'python -m %s value' % MODULE_NAME


def get(value):
    if value.isdigit():
        try:
            return Task.objects.get(**{"id":int(value)})
        except Task.DoesNotExist:
            pass
    for key in ["slug__iexact","name__iexact","class_name__iexact"]:
        try:
            return Task.objects.get(**{key:value})
        except Task.DoesNotExist:
            pass

@click.command()
@click.argument('values', nargs=-1,required=True)
def _cli(values):
    for value in values:
        t = get(value)
        if not t:
            sys.exit("task %s NOT FOUND" % value)
        now = datetime.datetime.now()
        t.updated_at = now
        t.completed_at = now
        t.todo = False
        t.save()

if __name__ == '__main__':
    _cli(prog_name=PROG_NAME)
